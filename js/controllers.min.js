!function(e){"use strict";e.module("mpsCtrls",[]).controller("mainCtrl",["$scope","$rootScope","$window",function(e,t,i){"1.0.19"!==window.localStorage.getItem("version")&&(window.localStorage.clear(),window.localStorage.setItem("version","1.0.19")),window.sessionStorage.getItem("visitorFlag")||window.sessionStorage.setItem("visitorFlag",Math.random().toString(36).substring(2)),t.docMode=!1}]).controller("indexCtrl",["$scope",function(e){}]).controller("loginCtrl",["$scope","$rootScope","$http","$element","$window","Api",function(e,t,i,n,a,r){/uuid\=/.test(document.cookie)&&window.localStorage.getItem("uuid")||(window.localStorage.setItem("uuid",UUID.generate()),document.cookie="uuid="+window.localStorage.getItem("uuid")),t.getLoginStatus=function(){var e=i({method:"POST",url:r.loginStatus,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},params:{token:window.localStorage.getItem("token")||""}});return e.then(function(e){"success"===e.data.status&&(t.isLogin=!0,t.userName=e.data.userInfo.reqUserName)}),e.catch(function(e){401===e.status&&(t.isLogin=!1,t.userName="")}),e},t.getLoginStatus();var o=function(){i({method:"POST",url:r.sysParams,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},data:"token="+(window.localStorage.getItem("token")||"")}).then(function(e){e.data&&200===e.data.code&&(t.payOpen="Y"===e.data.onlinePayFlag,t.helpAccountOpen="Y"===e.data.accountantShowFlag,t.$broadcast("$stateChangeSuccess"))})};o(),e.logout=function(){i({method:"POST",url:r.logout,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},data:"token="+window.localStorage.getItem("token")}).then(function(e){"success"===e.data.status&&(t.$broadcast("logoutSuccess"),t.notify.open({title:"提示",content:"帐号已退出。",type:"info"}),t.getLoginStatus(),o())})}}]).controller("overviewCtrl",["$scope","$state",function(e,t){e.goToAnchor=function(e,i){t.go(e,{anchor:i})}}]).controller("docCtrl",["$timeout","$anchorScroll","$stateParams",function(e,t,i){i.anchor&&e(function(){t(i.anchor)})}]).controller("demoCtrl",["$scope","$timeout","$element","$window","$rootScope","$state","Texts",function(e,t,i,n,a,r,o){var s=o.demoTexts;e.$on("$viewContentLoaded",function(){var t=r.current.name.split(".")[1];e.demoText=t?s[t]:null,e.path=t?o.path[t]:null}),e.swiper={slidesPerView:3,spaceBetween:10,observer:!0,observeParents:!0,slideToClickedSlide:!0,centeredSlides:!0}}]).controller("demoFaceCtrl",["$scope","$rootScope","$timeout","$element","FileSrv","$http","Api","NetSrv","Texts",function(e,t,i,n,a,r,o,s,c){e.data={origin:{file:null,src:null},contrast:{file:null,src:null},result:null,finished:!1},e.compare=function(){var t=function(t){t&&(e.data.result=t,e.data.finished=!0)};s.ajaxFw({url:o.face,data:a.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:[e.data.origin.file,e.data.contrast.file]}),headers:{"Content-Type":void 0},success:t,failAlert:!0})},Object.defineProperty(e,"simiDesc",{get:function(){if(e.data.result&&e.data.result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.ucScore){var t=~~(100*e.data.result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.ucScore);return t>=90?"可能性很高":t<90&&t>=80?"可能性高":t<80&&t>=30?"可能性低":t<30?"可能性很低":void 0}}}),e.fileChanged=function(i,n){i.files.length&&(-1!==["image/jpeg","image/png","image/bmp"].indexOf(i.files[0].type)?(e.data.finished=!1,e.data.result=null,a.imgCompress({file:i.files[0],maxPix:4915200,maxByte:1048576,cpsRatio:.7}).then(function(t){e.data[n]={file:t,src:window.URL.createObjectURL(t)},i.value="",e.$apply("data")})):t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"}))}}]).controller("demoIdCardCtrl",["$scope","Texts",function(e,t){e.trans=t.trans.idCard,e.certType="CN",e.modeType="single",e.keyEnable=function(e){return-1===["idCardSide"].indexOf(e)}}]).controller("demoIdCardCtrl.single",["$scope","$rootScope","Api","NetSrv","FileSrv",function(e,t,i,n,a){e.dataList=[],e.activeIndex=-1,e.fileChanged=function(r){if(r.files.length)if(-1!==["image/jpeg","image/png","image/bmp"].indexOf(r.files[0].type)){var o={file:r.files[0],src:window.URL.createObjectURL(r.files[0]),params:{region:e.$parent.$parent.certType},result:null};e.dataList.push(o),e.activeIndex=e.dataList.length-1,e.$apply("dataList"),n.ajaxFw({url:i.idCard,data:a.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:e.dataList[e.activeIndex].file,region:e.dataList[e.activeIndex].params.region,dataFormat:"simple"}),headers:{"Content-Type":void 0},success:function(t){e.dataList[e.activeIndex].result=t},failAlert:!0}),r.value=""}else t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"})},e.$watch("activeIndex",function(t,i){t!==i&&(e.$parent.$parent.certType=e.dataList[t].params.region)}),e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.$apply("activeIndex"))})}]).controller("demoIdCardCtrl.multiple",["$scope","$rootScope","Api","NetSrv","FileSrv",function(t,i,n,a,r){t.dataList=[],t.maxLength=9,t.activeIndex={group:-1,item:-1},t.viewMode="group";var o=function(e){this.file=e,this.src=window.URL.createObjectURL(e),this.params={region:t.$parent.$parent.certType},this.result=null},s=function(){this.items=[],Object.defineProperty(this,"commonTh",{get:function(){var i=[];if(!t.dataList[t.activeIndex.group]||!t.dataList[t.activeIndex.group].items.length)return i;for(var n=t.dataList[t.activeIndex.group].items.length;n--;)if(t.dataList[t.activeIndex.group].items[n].result&&"00000"===t.dataList[t.activeIndex.group].items[n].result.mpRecognition.resCd){var a=JSON.parse(e.toJson(t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult));for(var r in a)-1===i.indexOf(r)&&i.push(r)}return i}})};t.fileChanged=function(e,c){if(e.files.length){for(var l=[],u=!1,p=0;p<e.files.length;p++)-1!==["image/jpeg","image/png","image/bmp"].indexOf(e.files[p].type)?l.push(e.files[p]):u=!0;if(u&&i.notify.open({title:"警告",content:"选择的文件中包含不合法文件，已被过滤。",type:"warning"}),l.length){({group:function(){l.length>t.maxLength&&(l=l.slice(0,t.maxLength),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"}));var e=new s;l.forEach(function(t,i){e.items.push(new o(t))}),t.dataList.push(e),t.activeIndex.group=t.dataList.length-1,t.activeIndex.item=0},item:function(){l.length>t.maxLength-t.dataList[t.activeIndex.group].items.length&&(l=l.slice(0,t.maxLength-t.dataList[t.activeIndex.group].items.length),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"})),l.forEach(function(e,i){t.dataList[t.activeIndex.group].items.push(new o(e))}),t.activeIndex.item=t.dataList[t.activeIndex.group].items.length-1}})[c](),t.$apply("activeIndex"),e.value="",i.spinnerShow=!0;for(var d=l.length,g=d,f=t.dataList[t.activeIndex.group].items.length-d;d--;)!function(){var e=f+d;a.ajaxFw({url:n.idCard,data:r.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:t.dataList[t.activeIndex.group].items[e].file,region:t.dataList[t.activeIndex.group].items[e].params.region,dataFormat:"simple"}),headers:{"Content-Type":void 0},success:function(n){t.dataList[t.activeIndex.group].items[e].result=n,--g||(i.spinnerShow=!1)},failAlert:!0,spinner:!1})}()}}},t.$watch("activeIndex",function(e,i){e!==i&&(t.$parent.$parent.certType=t.dataList[e.group].items[e.item].params.region)},!0),t.$on("swiperSlideChange",function(e,i){"number"==typeof i&&(t.activeIndex.group=i,t.activeIndex.item=0,t.viewMode="group",t.$apply("activeIndex"))})}]).controller("demoCreditCardCtrl",["$scope","Texts",function(e,t){e.trans=t.trans.creditCard,e.modeType="single"}]).controller("demoCreditCardCtrl.single",["$scope","$rootScope","NetSrv","Api","FileSrv",function(e,t,i,n,a){e.dataList=[],e.activeIndex=-1,e.fileChanged=function(r){if(r.files.length)if(-1!==["image/jpeg","image/png","image/bmp"].indexOf(r.files[0].type)){var o={file:r.files[0],src:window.URL.createObjectURL(r.files[0]),result:null};e.dataList.push(o),e.activeIndex=e.dataList.length-1,e.$apply("dataList"),i.ajaxFw({url:n.creditCard,data:a.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:e.dataList[e.activeIndex].file,dataFormat:"simple"}),headers:{"Content-Type":void 0},success:function(t){e.dataList[e.activeIndex].result=t},failAlert:!0}),r.value=""}else t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"})},e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.$apply("activeIndex"))})}]).controller("demoCreditCardCtrl.multiple",["$scope","$rootScope","NetSrv","Api","FileSrv",function(t,i,n,a,r){t.dataList=[],t.maxLength=9,t.activeIndex={group:-1,item:-1},t.viewMode="group";var o=function(e){this.file=e,this.src=window.URL.createObjectURL(e),this.result=null},s=function(){this.items=[],Object.defineProperty(this,"commonTh",{get:function(){var i=[];if(!t.dataList[t.activeIndex.group]||!t.dataList[t.activeIndex.group].items.length)return i;for(var n=t.dataList[t.activeIndex.group].items.length;n--;)if(t.dataList[t.activeIndex.group].items[n].result&&"00000"===t.dataList[t.activeIndex.group].items[n].result.mpRecognition.resCd){var a=JSON.parse(e.toJson(t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult));for(var r in a)-1===i.indexOf(r)&&i.push(r)}return i}})};t.fileChanged=function(e,c){if(e.files.length){for(var l=[],u=!1,p=0;p<e.files.length;p++)-1!==["image/jpeg","image/png","image/bmp"].indexOf(e.files[p].type)?l.push(e.files[p]):u=!0;if(u&&i.notify.open({title:"警告",content:"选择的文件中包含不合法文件，已被过滤。",type:"warning"}),l.length){({group:function(){l.length>t.maxLength&&(l=l.slice(0,t.maxLength),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"}));var e=new s;l.forEach(function(t,i){e.items.push(new o(t))}),t.dataList.push(e),t.activeIndex.group=t.dataList.length-1,t.activeIndex.item=0},item:function(){l.length>t.maxLength-t.dataList[t.activeIndex.group].items.length&&(l=l.slice(0,t.maxLength-t.dataList[t.activeIndex.group].items.length),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"})),l.forEach(function(e,i){t.dataList[t.activeIndex.group].items.push(new o(e))}),t.activeIndex.item=t.dataList[t.activeIndex.group].items.length-1}})[c](),t.$apply("activeIndex"),e.value="",i.spinnerShow=!0;for(var d=l.length,g=d,f=t.dataList[t.activeIndex.group].items.length-d;d--;)!function(){var e=f+d;n.ajaxFw({url:a.creditCard,data:r.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:t.dataList[t.activeIndex.group].items[e].file,dataFormat:"simple"}),headers:{"Content-Type":void 0},success:function(n){t.dataList[t.activeIndex.group].items[e].result=n,--g||(i.spinnerShow=!1)},failAlert:!0,spinner:!1})}()}}},t.$on("swiperSlideChange",function(e,i){"number"==typeof i&&(t.activeIndex.group=i,t.activeIndex.item=0,t.viewMode="group",t.$apply("activeIndex"))})}]).controller("demoVatCtrl",["$scope","$rootScope","Api","Texts","FileSrv","NetSrv","$http",function(e,t,i,n,a,r,o){e.trans=n.trans.vat,e.modeType="single",e.keyEnable=function(e){return-1===["detail","RecMethod","Result"].indexOf(e)},e.ocrMode="ocr";var s;e.switchOcrMode=function(i){({ocr:function(){e.ocrMode="ocr"},check:function(){t.isLogin?e.ocrMode="check":(t.notify.open({title:"请登录",content:"增值税验真需登录使用。",type:"info"}),s=!0,t.showLogin=!0)}})[i]()};var c=function(){var n=o({method:"GET",url:i.getVatKey,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},params:{token:window.localStorage.getItem("token")}});return n.then(function(i){i.data&&"session_timeout"!==i.data&&i.data.apiKey?e.checkApiKey=i.data.apiKey:t.notify.open({title:"错误",content:"没有获取到 APIKey。",type:"error"})}),n};t.getLoginStatus().then(function(e){t.isLogin&&c()}),e.$on("loginSuccess",function(){c().then(function(){t.showLogin="",s&&(e.ocrMode="check",s=!1)})}),e.$on("logoutSuccess",function(){e.ocrMode="ocr"}),e.getConfig=function(){e.fields=n.fields.getConfig()},e.saveConfig=function(){n.fields.saveConfig(e.fields)},e.$watch("fields",function(t,i){if(t!==i){var n=!0;for(var a in t)t[a].display&&t[a].checked&&(n=!1);e.saveDisabled=n}},!0)}]).controller("demoVatCtrl.single",["$scope","$rootScope","NetSrv","Api","Texts","FileSrv",function(e,t,i,n,a,r){e.dataList=[],e.activeIndex=-1,e.fileChanged=function(o){if(o.files.length)if(-1!=={ocr:["image/jpeg","image/png","image/bmp","application/pdf"],check:["image/jpeg","image/png","image/bmp"]}[e.$parent.$parent.ocrMode].indexOf(o.files[0].type)){var s={file:o.files[0],src:window.URL.createObjectURL(o.files[0]),params:{ocrMode:e.$parent.$parent.ocrMode},result:null};e.dataList.push(s),e.activeIndex=e.dataList.length-1,e.$apply("dataList"),i.ajaxFw({url:{ocr:n.vat,check:n.ocr}[e.$parent.$parent.ocrMode],data:r.formData({ocr:{imgFile:e.dataList[e.activeIndex].file,visitorFlag:window.sessionStorage.getItem("visitorFlag"),openField:a.fields.openField()},check:{apiKey:e.$parent.checkApiKey,serviceType:4002,responseType:0,imgFile:e.dataList[e.activeIndex].file}}[e.$parent.$parent.ocrMode]),headers:{"Content-Type":void 0},success:function(t){e.dataList[e.activeIndex].result=t},failAlert:!0}),o.value=""}else t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"})},e.$watch("activeIndex",function(t,i){t!==i&&(e.$parent.$parent.certType=e.dataList[t].params.ocrMode)}),e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.$parent.$parent.ocrMode=e.dataList[i].params.ocrMode,e.$apply("dataList"))}),e.exportExcel=function(){window.open(n.vat2Excel+"?requestIds="+e.dataList[e.activeIndex].result.mpRecognition.requestId)}}]).controller("demoVatCtrl.multiple",["$scope","$rootScope","NetSrv","Api","Texts","FileSrv",function(t,i,n,a,r,o){t.dataList=[],t.maxLength=9,t.activeIndex={group:-1,item:-1},t.viewMode="group";var s=function(e){this.file=e,this.src=window.URL.createObjectURL(e),this.params={ocrMode:t.$parent.$parent.ocrMode},this.result=null},c=function(){this.items=[],Object.defineProperty(this,"commonTh",{get:function(){var i=[];if(!t.dataList[t.activeIndex.group]||!t.dataList[t.activeIndex.group].items.length)return i;for(var n=t.dataList[t.activeIndex.group].items.length;n--;)if(t.dataList[t.activeIndex.group].items[n].result&&"00000"===t.dataList[t.activeIndex.group].items[n].result.mpRecognition.resCd){if(t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.resCode){if("1"!==t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.resCode||!t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.data)continue;var a=t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.data;for(var r in a)-1===i.indexOf(r)&&i.push(r)}for(var o=JSON.parse(e.toJson(t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.data)),s=o.length;s--;)for(var r in o[s])-1===i.indexOf(r)&&i.push(r)}return i}})};t.fileChanged=function(e,l){if(e.files.length){for(var u=[],p={ocr:["image/jpeg","image/png","image/bmp","application/pdf"],check:["image/jpeg","image/png","image/bmp"]},d=!1,g=0;g<e.files.length;g++)-1!==p[t.$parent.$parent.ocrMode].indexOf(e.files[g].type)?u.push(e.files[g]):d=!0;if(d&&i.notify.open({title:"警告",content:"选择的文件中包含不合法文件，已被过滤。",type:"warning"}),u.length){({group:function(){u.length>t.maxLength&&(u=u.slice(0,t.maxLength),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"}));var e=new c;u.forEach(function(t,i){e.items.push(new s(t))}),t.dataList.push(e),t.activeIndex.group=t.dataList.length-1,t.activeIndex.item=0},item:function(){u.length>t.maxLength-t.dataList[t.activeIndex.group].items.length&&(u=u.slice(0,t.maxLength-t.dataList[t.activeIndex.group].items.length),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"})),u.forEach(function(e,i){t.dataList[t.activeIndex.group].items.push(new s(e))}),t.activeIndex.item=t.dataList[t.activeIndex.group].items.length-1}})[l](),t.$apply("activeIndex"),e.value="",i.spinnerShow=!0;for(var f=u.length,m=f,v=t.dataList[t.activeIndex.group].items.length-f;f--;)!function(){var e=v+f;n.ajaxFw({url:{ocr:a.vat,check:a.ocr}[t.$parent.$parent.ocrMode],data:o.formData({ocr:{imgFile:t.dataList[t.activeIndex.group].items[e].file,openField:r.fields.openField(),visitorFlag:window.sessionStorage.getItem("visitorFlag")},check:{apiKey:t.$parent.checkApiKey,serviceType:4002,responseType:0,imgFile:t.dataList[t.activeIndex.group].items[e].file}}[t.$parent.$parent.ocrMode]),headers:{"Content-Type":void 0},success:function(n){t.dataList[t.activeIndex.group].items[e].result=n,--m||(i.spinnerShow=!1)},failAlert:!0,spinner:!1})}()}}},t.$watch("activeIndex",function(e,i){e!==i&&(t.$parent.$parent.ocrMode=t.dataList[e.group].items[e.item].params.ocrMode)},!0),t.$on("swiperSlideChange",function(e,i){"number"==typeof i&&(t.activeIndex.group=i,t.activeIndex.item=0,t.viewMode="group",t.$apply("activeIndex"))}),t.exportExcel={execute:function(){var e=[],i=function(t){"00000"===t.mpRecognition.resCd&&e.push(t.mpRecognition.requestId)};({group:function(){for(var e=t.dataList[t.activeIndex.group].items.length;e--;)i(t.dataList[t.activeIndex.group].items[e].result)},item:function(){i(t.dataList[t.activeIndex.group].items[t.activeIndex.item].result)}})[t.viewMode](),e.length,window.open(a.vat2Excel+"?requestIds="+e.join(","))},get allow(){return{group:function(){var e=0;if(!t.dataList[t.activeIndex.group])return e;for(var i=t.dataList[t.activeIndex.group].items.length;i--;)t.dataList[t.activeIndex.group].items[i].result&&("00000"!==t.dataList[t.activeIndex.group].items[i].result.mpRecognition.resCd||t.dataList[t.activeIndex.group].items[i].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.resCode&&"1"!==t.dataList[t.activeIndex.group].items[i].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.resCode||e++);return e},item:function(){return"00000"===t.dataList[t.activeIndex.group].items[t.activeIndex.item].result.mpRecognition.resCd&&(!t.dataList[t.activeIndex.group].items[t.activeIndex.item].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.resCode||"1"===t.dataList[t.activeIndex.group].items[t.activeIndex.item].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.resCode)}}[t.viewMode]()}}}]).controller("demoFinStaCtrl",["$scope","Api","FileSrv","NetSrv","Texts",function(e,t,i,n,a){e.trans=a.trans.finSta,e.modeType="single"}]).controller("demoFinStaCtrl.single",["$scope","$rootScope","Api","FileSrv","NetSrv",function(e,t,i,n,a){e.dataList=[],e.activeIndex=-1,e.fileChanged=function(r){if(r.files.length)if(-1!==["image/jpeg","image/png","image/bmp"].indexOf(r.files[0].type)){var o={id:UUID.generate(),file:r.files[0],src:window.URL.createObjectURL(r.files[0]),result:null};e.dataList.push(o),e.activeIndex=e.dataList.length-1,e.$apply("dataList"),a.ajaxFw({url:i.finSta,data:n.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:e.dataList[e.activeIndex].file}),headers:{"Content-Type":void 0},success:function(t){e.dataList[e.activeIndex].result=t},failAlert:!0}),r.value=""}else t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"})},e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.$apply("activeIndex"))})}]).controller("demoFinStaCtrl.multiple",["$scope","$rootScope","Api","FileSrv","NetSrv",function(e,t,i,n,a){e.dataList=[],e.maxLength=9,e.activeIndex={group:-1,item:-1},e.viewMode="group";var r=function(e){this.id=UUID.generate(),this.file=e,this.src=window.URL.createObjectURL(e),this.result=null},o=function(){this.items=[]};e.fileChanged=function(s,c){if(s.files.length){for(var l=[],u=!1,p=0;p<s.files.length;p++)-1!==["image/jpeg","image/png","image/bmp"].indexOf(s.files[p].type)?l.push(s.files[p]):u=!0;if(u&&t.notify.open({title:"警告",content:"选择的文件中包含不合法文件，已被过滤。",type:"warning"}),l.length){({group:function(){l.length>e.maxLength&&(l=l.slice(0,e.maxLength),t.notify.open({title:"警告",content:"单次最多识别 "+e.maxLength+" 张图片，超过部分已被截取。",type:"warning"}));var i=new o;l.forEach(function(e,t){i.items.push(new r(e))}),e.dataList.push(i),e.activeIndex.group=e.dataList.length-1,e.activeIndex.item=0},item:function(){l.length>e.maxLength-e.dataList[e.activeIndex.group].items.length&&(l=l.slice(0,e.maxLength-e.dataList[e.activeIndex.group].items.length),t.notify.open({title:"警告",content:"单次最多识别 "+e.maxLength+" 张图片，超过部分已被截取。",type:"warning"})),l.forEach(function(t,i){e.dataList[e.activeIndex.group].items.push(new r(t))}),e.activeIndex.item=e.dataList[e.activeIndex.group].items.length-1}})[c](),e.$apply("activeIndex"),s.value="",t.spinnerShow=!0;for(var d=l.length,g=d,f=e.dataList[e.activeIndex.group].items.length-d;d--;)!function(){var r=f+d;a.ajaxFw({url:i.finSta,data:n.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:e.dataList[e.activeIndex.group].items[r].file}),headers:{"Content-Type":void 0},success:function(i){e.dataList[e.activeIndex.group].items[r].result=i,--g||(t.spinnerShow=!1)},failAlert:!0,spinner:!1})}()}}},e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex.group=i,e.activeIndex.item=0,e.viewMode="group",e.$apply("activeIndex"))})}]).controller("demoBusLisCtrl",["$scope","$rootScope","Api","Texts","$http","NetSrv",function(e,t,i,n,a,r){e.trans=n.trans.busLis,e.modeType="single",e.templates={12002:"新版营业执照",12003:"企业法人",12004:"个体工商户"},e.activeTemplate="12002";var o=function(){var n=a({method:"GET",url:i.getBusLisKey,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},params:{token:window.localStorage.getItem("token")}});return n.then(function(i){i.data&&"session_timeout"!==i.data&&i.data.apiKey?e.queryApiKey=i.data.apiKey:t.notify.open({title:"错误",content:"没有获取到 APIKey。",type:"error"})}),n};t.getLoginStatus().then(function(e){t.isLogin&&o()}),e.checkLogin=function(i){return new Promise(function(i,n){if(t.isLogin)i&&i(e.queryApiKey);else{t.notify.open({title:"请登录",content:"营业执照联网查询需登录使用。",type:"info"}),t.showLogin=!0;var a=e.$on("loginSuccess",function(){a(),o().then(function(){t.showLogin="",i&&i(e.queryApiKey)})})}})},e.getConfig=function(){e.fields=n.fields.getConfig()},e.saveConfig=function(){n.fields.saveConfig(e.fields)},e.$watch("fields",function(t,i){if(t!==i){var n=!0,a=t[e.activeTemplate];for(var r in a)a[r].display&&a[r].checked&&(n=!1);e.saveDisabled=n}},!0)}]).controller("demoBusLisCtrl.single",["$scope","$rootScope","Api","Texts","FileSrv","NetSrv",function(e,t,i,n,a,r){var o={12002:[],12003:[],12004:[]};Object.defineProperty(e,"dataList",{get:function(){return o[e.$parent.activeTemplate]},set:function(t){o[e.$parent.activeTemplate]=t}});var s={12002:-1,12003:-1,12004:-1};Object.defineProperty(e,"activeIndex",{get:function(){return s[e.$parent.activeTemplate]},set:function(t){s[e.$parent.activeTemplate]=t}}),e.fileChanged=function(o){if(o.files.length)if(-1!==["image/jpeg","image/png","image/bmp"].indexOf(o.files[0].type)){var s={id:UUID.generate(),file:o.files[0],src:window.URL.createObjectURL(o.files[0]),result:null};e.dataList.push(s),e.activeIndex=e.dataList.length-1,e.$apply("dataList"),r.ajaxFw({url:i.busLis,data:a.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:e.dataList[e.activeIndex].file,template:e.$parent.activeTemplate,openField:n.fields.openField(e.$parent.activeTemplate)}),headers:{"Content-Type":void 0},success:function(t){e.dataList[e.activeIndex].result=t},failAlert:!0}),o.value=""}else t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"})},e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.$apply("activeIndex"))})}]).controller("demoBusLisCtrl.multiple",["$scope","$rootScope","Api","Texts","FileSrv","NetSrv",function(t,i,n,a,r,o){var s={12002:[],12003:[],12004:[]};Object.defineProperty(t,"dataList",{get:function(){return s[t.$parent.activeTemplate]},set:function(e){s[t.$parent.activeTemplate]=e}});var c={12002:{group:-1,item:-1},12003:{group:-1,item:-1},12004:{group:-1,item:-1}};Object.defineProperty(t,"activeIndex",{get:function(){return c[t.$parent.activeTemplate]},set:function(e){c[t.$parent.activeTemplate]=e}}),t.maxLength=9,t.viewMode="group";var l=function(e){this.file=e,this.src=window.URL.createObjectURL(e),this.result=null},u=function(){this.items=[],Object.defineProperty(this,"commonTh",{get:function(){var i=[];if(!t.dataList[t.activeIndex.group]||!t.dataList[t.activeIndex.group].items.length)return i;for(var n=t.dataList[t.activeIndex.group].items.length;n--;)if(t.dataList[t.activeIndex.group].items[n].result&&"00000"===t.dataList[t.activeIndex.group].items[n].result.mpRecognition.resCd){var a=JSON.parse(e.toJson(t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult));for(var r in a)-1===i.indexOf(r)&&i.push(r)}return i}})};t.fileChanged=function(e,s){if(e.files.length){for(var c=[],p=!1,d=0;d<e.files.length;d++)-1!==["image/jpeg","image/png","image/bmp"].indexOf(e.files[d].type)?c.push(e.files[d]):p=!0;if(p&&i.notify.open({title:"警告",content:"选择的文件中包含不合法文件，已被过滤。",type:"warning"}),c.length){({group:function(){c.length>t.maxLength&&(c=c.slice(0,t.maxLength),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"}));var e=new u;c.forEach(function(t,i){e.items.push(new l(t))}),t.dataList.push(e),t.activeIndex.group=t.dataList.length-1,t.activeIndex.item=0},item:function(){c.length>t.maxLength-t.dataList[t.activeIndex.group].items.length&&(c=c.slice(0,t.maxLength-t.dataList[t.activeIndex.group].items.length),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"})),c.forEach(function(e,i){t.dataList[t.activeIndex.group].items.push(new l(e))}),t.activeIndex.item=t.dataList[t.activeIndex.group].items.length-1}})[s](),t.$apply("activeIndex"),e.value="",i.spinnerShow=!0;for(var g=c.length,f=g,m=t.dataList[t.activeIndex.group].items.length-g;g--;)!function(){var e=m+g;o.ajaxFw({url:n.busLis,data:r.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:t.dataList[t.activeIndex.group].items[e].file,template:t.$parent.activeTemplate,openField:a.fields.openField(t.$parent.activeTemplate)}),headers:{"Content-Type":void 0},success:function(n){t.dataList[t.activeIndex.group].items[e].result=n,--f||(i.spinnerShow=!1)},failAlert:!0,spinner:!1})}()}}},t.$watch("$parent.activeTemplate",function(){t.viewMode="group"}),t.$on("swiperSlideChange",function(e,i){"number"==typeof i&&(t.activeIndex.group=i,t.activeIndex.item=0,t.viewMode="group",t.$apply("activeIndex"))})}]).controller("demoFullTextCtrl",["$scope","NetSrv","Api","FileSrv","$window","Texts",function(e,t,i,n,a,r){e.trans=r.trans.fullTextCtrl,e.modeType="single",e.iType="0",e.coordinate=!1}]).controller("demoFullTextCtrl.single",["$scope","$rootScope","NetSrv","Api","FileSrv","Texts",function(e,t,i,n,a,r){e.dataList=[],e.activeIndex=-1,e.fileChanged=function(r){if(r.files.length)if(-1!==["image/jpeg","image/png","image/bmp","application/pdf"].indexOf(r.files[0].type)){var o={file:r.files[0],src:window.URL.createObjectURL(r.files[0]),params:{coordinate:e.$parent.$parent.coordinate,iType:e.$parent.$parent.iType},result:null};e.dataList.push(o),e.activeIndex=e.dataList.length-1,e.$apply("dataList"),i.ajaxFw({url:n.fullText,data:a.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),myfile:e.dataList[e.activeIndex].file,iType:e.dataList[e.activeIndex].params.iType,coordinate:e.dataList[e.activeIndex].params.coordinate?"1":"0"}),headers:{"Content-Type":void 0},success:function(t){e.dataList[e.activeIndex].result=t},failAlert:!0}),r.value=""}else t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"})},e.$watch("activeIndex",function(t,i){t!==i&&(e.$parent.$parent.iType=e.dataList[t].params.iType,e.$parent.$parent.coordinate=e.dataList[t].params.coordinate)}),e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.$apply("activeIndex"))})}]).controller("demoFullTextCtrl.multiple",["$scope","$rootScope","NetSrv","Api","FileSrv","Texts",function(t,i,n,a,r,o){t.dataList=[],t.maxLength=9,t.activeIndex={group:-1,item:-1},t.viewMode="group";var s=function(e){this.file=e,this.src=window.URL.createObjectURL(e),this.params={coordinate:t.$parent.$parent.coordinate,iType:t.$parent.$parent.iType},this.result=null},c=function(){this.items=[],Object.defineProperty(this,"commonTh",{get:function(){var i=[];if(!t.dataList[t.activeIndex.group]||!t.dataList[t.activeIndex.group].items.length)return i;for(var n=t.dataList[t.activeIndex.group].items.length;n--;)if(t.dataList[t.activeIndex.group].items[n].result&&"00000"===t.dataList[t.activeIndex.group].items[n].result.mpRecognition.resCd)for(var a=JSON.parse(e.toJson(t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult)),r=a.length;r--;)for(var o in a[r])-1===i.indexOf(o)&&i.push(o);return i}})};t.fileChanged=function(e,o){if(e.files.length){for(var l=[],u=!1,p=0;p<e.files.length;p++)-1!==["image/jpeg","image/png","image/bmp","application/pdf"].indexOf(e.files[p].type)?l.push(e.files[p]):u=!0;if(u&&i.notify.open({title:"警告",content:"选择的文件中包含不合法文件，已被过滤。",type:"warning"}),l.length){({group:function(){l.length>t.maxLength&&(l=l.slice(0,t.maxLength),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"}));var e=new c;l.forEach(function(t,i){e.items.push(new s(t))}),t.dataList.push(e),t.activeIndex.group=t.dataList.length-1,t.activeIndex.item=0},item:function(){l.length>t.maxLength-t.dataList[t.activeIndex.group].items.length&&(l=l.slice(0,t.maxLength-t.dataList[t.activeIndex.group].items.length),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"})),l.forEach(function(e,i){t.dataList[t.activeIndex.group].items.push(new s(e))}),t.activeIndex.item=t.dataList[t.activeIndex.group].items.length-1}})[o](),t.$apply("activeIndex"),e.value="",i.spinnerShow=!0;for(var d=l.length,g=d,f=t.dataList[t.activeIndex.group].items.length-d;d--;)!function(){var e=f+d;n.ajaxFw({url:a.fullText,data:r.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),myfile:t.dataList[t.activeIndex.group].items[e].file,iType:t.dataList[t.activeIndex.group].items[e].params.iType,coordinate:t.dataList[t.activeIndex.group].items[e].params.coordinate?"1":"0"}),headers:{"Content-Type":void 0},success:function(n){t.dataList[t.activeIndex.group].items[e].result=n,--g||(i.spinnerShow=!1)},failAlert:!0,spinner:!1})}()}}},t.$watch("activeIndex",function(e,i){e!==i&&(t.$parent.$parent.coordinate=t.dataList[e.group].items[e.item].params.coordinate,t.$parent.$parent.iType=t.dataList[e.group].items[e.item].params.iType)},!0),t.$on("swiperSlideChange",function(e,i){"number"==typeof i&&(t.activeIndex.group=i,t.activeIndex.item=0,t.viewMode="group",t.$apply("activeIndex"))})}]).controller("solutionHelpAccountCtrl",["$scope","$rootScope","Texts","$window","Api","DataSrv","NetSrv",function(e,t,i,n,a,r,o){function s(t){(c=new WebSocket(a.helpAccountQueryWS)).onopen=function(e){c.send(JSON.stringify({sequence:t}))},c.onmessage=function(i){var n=JSON.parse(i.data);e.allData[t].results[n.mpRecognition.serialNumber]=n,e.allData[t].recElapsed=Date.now()-e.allData[t].time,e.$apply("overviewRow"),e.$apply("data"),e.currentState.finished&&c.close()},c.onclose=function(e){console.log("Sequence "+t+" over.")}}e.path=i.path.helpAccount,e.fields=i.fields.getConfig(),e.$watch("fields",function(t,i){t!==i&&window.localStorage.setItem("helpAccountVatFields",JSON.stringify(e.fields))},!0),Object.defineProperty(e,"openFieldStr",{get:function(){return i.fields.openField()}});var c=null;e.allData={},Object.defineProperty(e,"successData",{get:function(){var t={};for(var i in e.allData){var n={files:{},srcs:{},results:{}},a=JSON.stringify(n);for(var r in e.allData[i].results)e.allData[i].results[r].mpRecognition.toHandle||(n.results[r]=e.allData[i].results[r],n.srcs[r]=e.allData[i].srcs[r],n.files[r]=e.allData[i].files[r]);JSON.stringify(n)!==a&&(n.time=e.allData[i].time,n.uploadElapsed=e.allData[i].uploadElapsed,n.recElapsed=e.allData[i].recElapsed,t[i]=n)}return t}}),Object.defineProperty(e,"failedData",{get:function(){var t={};for(var i in e.allData){var n={files:{},srcs:{},results:{}},a=JSON.stringify(n);for(var r in e.allData[i].results)e.allData[i].results[r].mpRecognition.toHandle&&(n.results[r]=e.allData[i].results[r],n.srcs[r]=e.allData[i].srcs[r],n.files[r]=e.allData[i].files[r]);JSON.stringify(n)!==a&&(n.time=e.allData[i].time,n.uploadElapsed=e.allData[i].uploadElapsed,n.recElapsed=e.allData[i].recElapsed,t[i]=n)}return t}}),e.strEqual=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},e.data=e.allData;e.currentView="upload-rec",e.currentGroup={},e.currentSequence="";var l="";e.groupComputed={get currentGroupArray(){var t={};for(var i in e.currentGroup)t[i]="results"===i||"files"===i||"srcs"===i?[]:e.currentGroup[i];for(var i in e.currentGroup.files)t.files.push(e.currentGroup.files[i]),t.results.push(e.currentGroup.results[i]),t.srcs.push(e.currentGroup.srcs[i]);return t},get activeIndex(){var t=0;if(l&&e.currentGroup.files[l])for(var i in e.currentGroup.files){if(l===i)break;t++}return t},get groupLength(){var t=0;for(var i in e.currentGroup.files)t++;return t},get atFirst(){return 0===this.activeIndex},get atLast(){return this.activeIndex===this.groupLength-1},get indexMapProp(){var t=[];for(var i in e.currentGroup.files)t.push(i);return t},get propMapIndex(){for(var e={},t=0;t<this.indexMapProp.length;t++)e[this.indexMapProp[t]]=t;return e},toPrev:function(){this.atFirst||(this.currentSerialNumber=this.indexMapProp[this.activeIndex-1])},toNext:function(){this.atLast||(this.currentSerialNumber=this.indexMapProp[this.activeIndex+1])},get visibleImgs(){var t={};return this.groupLength<3?e.currentGroup.srcs:(this.atFirst?(t[this.indexMapProp[0]]=e.currentGroup.srcs[this.indexMapProp[0]],t[this.indexMapProp[1]]=e.currentGroup.srcs[this.indexMapProp[1]],t[this.indexMapProp[2]]=e.currentGroup.srcs[this.indexMapProp[2]]):this.atLast?(t[this.indexMapProp[this.groupLength-3]]=e.currentGroup.srcs[this.indexMapProp[this.groupLength-3]],t[this.indexMapProp[this.groupLength-2]]=e.currentGroup.srcs[this.indexMapProp[this.groupLength-2]],t[this.indexMapProp[this.groupLength-1]]=e.currentGroup.srcs[this.indexMapProp[this.groupLength-1]]):(t[this.indexMapProp[this.activeIndex-1]]=e.currentGroup.srcs[this.indexMapProp[this.activeIndex-1]],t[this.indexMapProp[this.activeIndex]]=e.currentGroup.srcs[this.indexMapProp[this.activeIndex]],t[this.indexMapProp[this.activeIndex+1]]=e.currentGroup.srcs[this.indexMapProp[this.activeIndex+1]]),t)},get currentSerialNumber(){if(!l||!e.currentGroup.files[l])for(var t in e.currentGroup.files){l=t;break}return l},set currentSerialNumber(e){l=e}},Object.defineProperty(e,"flatOcrResult",{get:function(){try{return r.dataFlat(e.currentGroup.results[e.groupComputed.currentSerialNumber].mpRecognition.ocrInfoList.ocrInfo.ocrResult,!0)}catch(e){return{}}},set:function(e){console.log(e)}}),e.ocrResultFlating=function(e){try{return r.dataFlat(e.mpRecognition.ocrInfoList.ocrInfo.ocrResult,!0)}catch(e){return{}}},Object.defineProperty(e,"flatOcrConfidence",{get:function(){try{return r.dataFlat(e.currentGroup.results[e.groupComputed.currentSerialNumber].mpRecognition.ocrInfoList.ocrInfo.ocrConfidence)}catch(e){return{}}}}),e.ocrConfidenceFlating=function(e){try{return r.dataFlat(e.mpRecognition.ocrInfoList.ocrInfo.ocrResult)}catch(e){return{}}},e.NOFilter="",e.filt=function(){e.changeCurrentGroup.merge();var t={files:{},srcs:{},results:{}};for(var i in e.currentGroup.results)e.ocrResultFlating(e.currentGroup.results[i]).InvoiceNumber&&-1!==e.ocrResultFlating(e.currentGroup.results[i]).InvoiceNumber.indexOf(e.NOFilter)&&(t.files[i]=e.currentGroup.files[i],t.srcs[i]=e.currentGroup.srcs[i],t.results[i]=e.currentGroup.results[i]);e.currentGroup=t},e.changeCurrentGroup={bySequence:function(t){e.currentGroup=e.data[t]},merge:function(){var t={files:{},srcs:{},results:{}};for(var i in e.data)for(var n in e.data[i].results)t.files[n]=e.data[i].files[n],t.srcs[n]=e.data[i].srcs[n],t.results[n]=e.data[i].results[n];e.currentGroup=t}},Object.defineProperty(e,"hasFile",{get:function(){var t=!1;for(var i in e.data)for(var n in e.data[i].files)t=!0;return t}}),e.fileChanged=function(i){function n(t,i){var n=new FormData;return n.append("visitorFlag",window.sessionStorage.getItem("visitorFlag")),n.append("openField",e.openFieldStr),n.append("serialNumber",t),n.append("sequence",e.currentSequence),n.append("myfile",d[t]),new Promise(function(t,i){o.ajaxFw({url:a.helpAccountCall,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:n,spinner:!1,success:function(i){e.currentState.receiveCount++,e.allData[e.currentSequence].uploadElapsed=Date.now()-e.data[e.currentSequence].time,t()}})})}for(var r=i.files,c=r.length,l=0,u=!1,p=!1,d={};c--;){if(l>=20){u=!0;break}/^image\/./.test(r[c].type)?(d[UUID.generate()]=r[c],l++):p=!0}if(u&&(3e3,t.notify.open({title:"警告",content:"单次最多识别 20 张图片",type:"warning"})),p&&t.notify.open({title:"警告",content:"包含非图片，非图片将被过滤",type:"warning"}),l){e.currentSequence=UUID.generate();var g=Date.now();e.data[e.currentSequence]={files:d,results:{},srcs:function(){var e={};for(var t in d)e[t]=window.URL.createObjectURL(d[t]);return e}(),time:g,uploadElapsed:0,recElapsed:0},s(e.currentSequence);var f=0;for(var m in d){n(m).then(function(){for(var e in d)f&&n(e),f++}).catch(function(e){console.log(e)});break}i.value=""}},e.overviewRow={fileCount:function(e){var t=0;if(e&&e.files)for(var i in e.files)t++;return t},finishCount:function(e){var t=0;if(e&&e.results)for(var i in e.results)e.results[i].mpRecognition&&t++;return t},successCount:function(e){return this.finishCount(e)-this.failedCount(e)},failedCount:function(e){var t=0;for(var i in e.results)e.results[i].mpRecognition.toHandle&&t++;return t},successRate:function(e){var t=this.successCount(e);return t/(t+this.failedCount(e))||0},createDate:function(e){return e.time},totalSize:function(e){var t=0;for(var i in e.files)t+=e.files[i].size;return t},uploadElapsed:function(e){return e.uploadElapsed},recElapsed:function(e){return e.recElapsed}},e.currentState={get sequence(){return e.currentSequence},get data(){return e.allData[this.sequence]},get fileCount(){return e.overviewRow.fileCount(this.data)},get totalSize(){return e.overviewRow.totalSize(this.data)},get successCount(){return e.overviewRow.successCount(this.data)},get failedCount(){return e.overviewRow.failedCount(this.data)},get successRate(){return e.overviewRow.successRate(this.data)},_receiveCountMap:{},get receiveCount(){return void 0===this._receiveCountMap[this.sequence]&&(this._receiveCountMap[this.sequence]=0),this._receiveCountMap[this.sequence]},set receiveCount(e){this._receiveCountMap[this.sequence]=e},get finishCount(){return e.overviewRow.finishCount(this.data)},get uploadElapsed(){return e.overviewRow.uploadElapsed(this.data)},get uploadElapsedFormat(){return moment(new Date(moment().format("YYYY-MM-DD")).getTime()+this.uploadElapsed).format("mm′ss″")},get recElapsed(){return e.overviewRow.recElapsed(this.data)},get recElapsedFormat(){return moment(new Date(moment().format("YYYY-MM-DD")).getTime()+this.recElapsed).format("mm′ss″")},get finished(){return this.finishCount===this.fileCount}}}]).controller("demoHandwrittenSignatureCtrl",["$scope","Texts",function(e,t){}]).controller("demoHandwrittenSignatureCtrl.recognition",["$scope","$rootScope","NetSrv","Api","FileSrv",function(e,t,i,n,a){e.dataList=[],e.activeIndex=null,e.limitLength=9,e.finished=!1,e.changeIndex=function(t){e.activeIndex=e.dataList[t]?t:e.activeIndex};var r=function(e){this.file=e,this.src=window.URL.createObjectURL(e),this.cropper={id:UUID.generate(),enable:!1,data:null}};e.fileChanged=function(i){if(i.files.length){for(var n=[],a=i.files.length,o=!1;a--;)/^image\/\w+$/g.test(i.files[a].type)?n.push(i.files[a]):o=!0;for(o&&t.notify.open({title:"警告",content:"不受支持的文件已被清除。",type:"warning"}),e.dataList.length+i.files.length>e.limitLength&&(n=Array.prototype.slice.call(n,0,e.limitLength-e.dataList.length),t.notify.open({title:"警告",content:"最多上传 "+e.limitLength+" 张图，超过部分已被截取。",type:"warning"})),a=n.length;a--;)e.dataList.push(new r(n[a]));e.changeIndex(null===e.activeIndex?0:e.activeIndex),e.finished=!1,e.$apply("dataList"),i.value=""}},e.reset=function(){e.dataList=[],e.activeIndex=null,e.finished=!1},e.$on("cropchange",function(){e.finished=!1,e.$apply("finished")}),e.recognition=function(){t.spinnerShow=!0;for(var r=e.dataList.length,o=r,s=0;r--;)!function(){var c=r,l=function(i){i&&i.mpRecognition&&(e.dataList[c].result=i),++s===o&&(t.spinnerShow=!1,e.finished=!0)},u={imgFile:e.dataList[c].file,visitorFlag:window.sessionStorage.getItem("visitorFlag")};e.dataList[c].cropper.enable&&(u.x=e.dataList[c].cropper.data.x,u.y=e.dataList[c].cropper.data.y,u.width=e.dataList[c].cropper.data.width,u.height=e.dataList[c].cropper.data.height),i.ajaxFw({url:n.handwrittenSignature.recognition,data:a.formData(u),headers:{"Content-Type":void 0},success:l,failAlert:!0,spinner:!1})}()}}]).controller("demoHandwrittenSignatureCtrl.verification",["$scope","$rootScope","NetSrv","Api","FileSrv",function(e,t,i,n,a){e.dataList=[],e.activeIndex=null,e.limitLength=9;var r=function(e){if(e instanceof File){var t=e,i=this;Object.defineProperty(this,"file",{get:function(){return t},set:function(e){t=e,i.src=window.URL.createObjectURL(e)}}),this.file=e}},o=function(e,t){this.origin=new r(e),this.contrast=t?$.extend([],t):[],this.result=null,this.finished=!1};Object.defineProperty(o.prototype,"clone",{value:function(){var e=new o;return e.origin=this.origin,e.contrast=$.extend([],this.contrast),e.result=this.result,e.finished=this.finished,e},enumerable:!1}),e.currentData=new o,e.fileChanged={origin:function(t){t.files.length&&/^image\/\w+$/g.test(t.files[0].type)&&(e.currentData=new o(t.files[0],e.currentData.contrast),e.$apply("currentData"),t.value="")},contrast:function(i){if(i.files.length){for(var n=[],a=i.files.length,o=!1;a--;)/^image\/\w+$/g.test(i.files[a].type)?n.push(new r(i.files[a])):o=!0;o&&t.notify.open({title:"警告",content:"不受支持的文件已被清除。",type:"warning"}),e.currentData.contrast=e.currentData.contrast.slice(),e.currentData.contrast.length+i.files.length>e.limitLength?(Array.prototype.push.apply(e.currentData.contrast,n.slice(0,e.limitLength-e.currentData.contrast.length)),t.notify.open({title:"警告",content:"最多上传 "+e.limitLength+" 张图，超过部分已被截取。",type:"warning"})):Array.prototype.push.apply(e.currentData.contrast,n),e.currentData.finished=!1,e.$apply("currentData"),i.value=""}}},e.reset=function(){e.currentData.contrast=[]},e.comparison=function(){var t=function(t){t&&t.mpRecognition&&(e.currentData.result=t),e.currentData.finished=!0,e.dataList.push(e.currentData.clone()),e.activeIndex=null===e.activeIndex?0:e.dataList.length-1};i.ajaxFw({url:n.handwrittenSignature.verification,data:a.formData({imgFiles:function(){for(var t=[e.currentData.origin.file],i=e.currentData.contrast.length;i--;)t.push(e.currentData.contrast[i].file);return t}(),visitorFlag:window.sessionStorage.getItem("visitorFlag")}),headers:{"Content-Type":void 0},success:t,failAlert:!0})},e.swiper={slidesPerView:4,spaceBetween:30,observer:!0,observeParents:!0,breakpoints:{1024:{slidesPerView:4,spaceBetween:40},768:{slidesPerView:3,spaceBetween:30},640:{slidesPerView:2,spaceBetween:20},320:{slidesPerView:1,spaceBetween:10}},slideToClickedSlide:!0,centeredSlides:!0},e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.currentData=e.dataList[i].clone(),e.$apply("currentData"))})}]).controller("demoSocialSecurityCardCtrl",["$scope","Texts",function(e,t){e.trans=t.trans.socialSecurityCard,e.modeType="single",e.keyEnable=function(e){return-1===["faceImg"].indexOf(e)}}]).controller("demoSocialSecurityCardCtrl.single",["$scope","$rootScope","NetSrv","Api","FileSrv",function(e,t,i,n,a){e.dataList=[],e.activeIndex=-1,e.fileChanged=function(r){if(r.files.length)if(-1!==["image/jpeg","image/png","image/bmp"].indexOf(r.files[0].type)){var o={file:r.files[0],src:window.URL.createObjectURL(r.files[0]),result:null};e.dataList.push(o),e.activeIndex=e.dataList.length-1,e.$apply("dataList"),i.ajaxFw({url:n.socialSecurityCard,data:a.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:e.dataList[e.activeIndex].file}),headers:{"Content-Type":void 0},success:function(t){e.dataList[e.activeIndex].result=t},failAlert:!0}),r.value=""}else t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"})},e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.$apply("activeIndex"))})}]).controller("demoSocialSecurityCardCtrl.multiple",["$scope","$rootScope","NetSrv","Api","FileSrv",function(t,i,n,a,r){t.dataList=[],t.maxLength=9,t.activeIndex={group:-1,item:-1},t.viewMode="group";var o=function(e){this.file=e,this.src=window.URL.createObjectURL(e),this.result=null},s=function(){this.items=[],Object.defineProperty(this,"commonTh",{get:function(){var i=[];if(!t.dataList[t.activeIndex.group]||!t.dataList[t.activeIndex.group].items.length)return i;for(var n=t.dataList[t.activeIndex.group].items.length;n--;)if(t.dataList[t.activeIndex.group].items[n].result&&"00000"===t.dataList[t.activeIndex.group].items[n].result.mpRecognition.resCd){var a=JSON.parse(e.toJson(t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo));for(var r in a)-1===i.indexOf(r)&&i.push(r)}return i}})};t.fileChanged=function(e,c){if(e.files.length){for(var l=[],u=!1,p=0;p<e.files.length;p++)-1!==["image/jpeg","image/png","image/bmp"].indexOf(e.files[p].type)?l.push(e.files[p]):u=!0;if(u&&i.notify.open({title:"警告",content:"选择的文件中包含不合法文件，已被过滤。",type:"warning"}),l.length){({group:function(){l.length>t.maxLength&&(l=l.slice(0,t.maxLength),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"}));var e=new s;l.forEach(function(t,i){e.items.push(new o(t))}),t.dataList.push(e),t.activeIndex.group=t.dataList.length-1,t.activeIndex.item=0},item:function(){l.length>t.maxLength-t.dataList[t.activeIndex.group].items.length&&(l=l.slice(0,t.maxLength-t.dataList[t.activeIndex.group].items.length),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"})),l.forEach(function(e,i){t.dataList[t.activeIndex.group].items.push(new o(e))}),t.activeIndex.item=t.dataList[t.activeIndex.group].items.length-1}})[c](),t.$apply("activeIndex"),e.value="",i.spinnerShow=!0;for(var d=l.length,g=d,f=t.dataList[t.activeIndex.group].items.length-d;d--;)!function(){var e=f+d;n.ajaxFw({url:a.socialSecurityCard,data:r.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:t.dataList[t.activeIndex.group].items[e].file}),headers:{"Content-Type":void 0},success:function(n){t.dataList[t.activeIndex.group].items[e].result=n,--g||(i.spinnerShow=!1)},failAlert:!0,spinner:!1})}()}}},t.$on("swiperSlideChange",function(e,i){"number"==typeof i&&(t.activeIndex.group=i,t.activeIndex.item=0,t.viewMode="group",t.$apply("activeIndex"))})}]).controller("demoTrainTicketCtrl",["$scope","Texts",function(e,t){e.trans=t.trans.trainTicket,e.modeType="single"}]).controller("demoTrainTicketCtrl.single",["$scope","$rootScope","NetSrv","Api","FileSrv",function(e,t,i,n,a){e.dataList=[],e.activeIndex=-1,e.fileChanged=function(r){if(r.files.length)if(-1!==["image/jpeg","image/png","image/bmp"].indexOf(r.files[0].type)){var o={file:r.files[0],src:window.URL.createObjectURL(r.files[0]),result:null};e.dataList.push(o),e.activeIndex=e.dataList.length-1,e.$apply("dataList"),i.ajaxFw({url:n.trainTicket,data:a.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:e.dataList[e.activeIndex].file}),headers:{"Content-Type":void 0},success:function(t){e.dataList[e.activeIndex].result=t},failAlert:!0}),r.value=""}else t.notify.open({title:"错误",content:"选择的文件类型不合法，请重新选择。",type:"error"})},e.$on("swiperSlideChange",function(t,i){"number"==typeof i&&(e.activeIndex=i,e.$apply("activeIndex"))})}]).controller("demoTrainTicketCtrl.multiple",["$scope","$rootScope","NetSrv","Api","FileSrv",function(t,i,n,a,r){t.dataList=[],t.maxLength=9,t.activeIndex={group:-1,item:-1},t.viewMode="group";var o=function(e){this.file=e,this.src=window.URL.createObjectURL(e),this.result=null},s=function(){this.items=[],Object.defineProperty(this,"commonTh",{get:function(){var i=[];if(!t.dataList[t.activeIndex.group]||!t.dataList[t.activeIndex.group].items.length)return i;for(var n=t.dataList[t.activeIndex.group].items.length;n--;)if(t.dataList[t.activeIndex.group].items[n].result&&"00000"===t.dataList[t.activeIndex.group].items[n].result.mpRecognition.resCd)for(var a=JSON.parse(e.toJson(t.dataList[t.activeIndex.group].items[n].result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.data)),r=a.length;r--;)for(var o in a[r])-1===i.indexOf(o)&&i.push(o);return i}})};t.fileChanged=function(e,c){if(e.files.length){for(var l=[],u=!1,p=0;p<e.files.length;p++)-1!==["image/jpeg","image/png","image/bmp"].indexOf(e.files[p].type)?l.push(e.files[p]):u=!0;if(u&&i.notify.open({title:"警告",content:"选择的文件中包含不合法文件，已被过滤。",type:"warning"}),l.length){({group:function(){l.length>t.maxLength&&(l=l.slice(0,t.maxLength),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"}));var e=new s;l.forEach(function(t,i){e.items.push(new o(t))}),t.dataList.push(e),t.activeIndex.group=t.dataList.length-1,t.activeIndex.item=0},item:function(){l.length>t.maxLength-t.dataList[t.activeIndex.group].items.length&&(l=l.slice(0,t.maxLength-t.dataList[t.activeIndex.group].items.length),i.notify.open({title:"警告",content:"单次最多识别 "+t.maxLength+" 张图片，超过部分已被截取。",type:"warning"})),l.forEach(function(e,i){t.dataList[t.activeIndex.group].items.push(new o(e))}),t.activeIndex.item=t.dataList[t.activeIndex.group].items.length-1}})[c](),t.$apply("activeIndex"),e.value="",i.spinnerShow=!0;for(var d=l.length,g=d,f=t.dataList[t.activeIndex.group].items.length-d;d--;)!function(){var e=f+d;n.ajaxFw({url:a.trainTicket,data:r.formData({visitorFlag:window.sessionStorage.getItem("visitorFlag"),imgFile:t.dataList[t.activeIndex.group].items[e].file}),headers:{"Content-Type":void 0},success:function(n){t.dataList[t.activeIndex.group].items[e].result=n,--g||(i.spinnerShow=!1)},failAlert:!0,spinner:!1})}()}}},t.$on("swiperSlideChange",function(e,i){"number"==typeof i&&(t.activeIndex.group=i,t.activeIndex.item=0,t.viewMode="group",t.$apply("activeIndex"))})}]).controller("priceCtrl",["$scope","$http","Api",function(e,t,i){e.current={storageApiTab:0,priceTab:0},e.storageTrans={23:"存储空间（GB）",3:"存储空间（月）"},t.get(i.price.feesPerTime).then(function(t){200===t.status&&t.data&&(e.perTime=t.data)}),t.get(i.price.feesPerMonth).then(function(t){200===t.status&&t.data&&(e.perMonth=t.data)}),t.get(i.price.feesPerYear).then(function(t){200===t.status&&t.data&&(e.perYear=t.data)}),t.get(i.price.imageStorage).then(function(t){200===t.status&&t.data&&(e.imageStorage=t.data)})}]).controller("contactCtrl",["$scope","$rootScope",function(e,t){e.current=0}])}(window.angular);
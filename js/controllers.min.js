!function(e){"use strict";e.module("mpsCtrls",[]).controller("mainCtrl",["$scope","$rootScope","$window",function(e,t,i){"1.0.19"!==window.localStorage.getItem("version")&&(window.localStorage.clear(),window.localStorage.setItem("version","1.0.19")),i.sessionStorage.getItem("visitorFlag")||i.sessionStorage.setItem("visitorFlag",Math.random().toString(36).substring(2)),t.docMode=!1}]).controller("indexCtrl",["$scope",function(e){e.$on("$viewContentLoaded",function(){$(".carousel").carousel({interval:5e3})})}]).controller("loginCtrl",["$scope","$rootScope","$http","$element","$window","Api","DataSrv",function(e,t,i,a,n,r,o){/uuid\=/.test(document.cookie)&&n.localStorage.getItem("uuid")||(n.localStorage.setItem("uuid",o.uuid()),document.cookie="uuid="+n.localStorage.getItem("uuid"));var s=function(){i({method:"POST",url:r.loginStatus,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},data:"token="+(n.localStorage.getItem("token")||"")}).then(function(t){"success"===t.data.status&&(e.isLogin=!0,e.userName=t.data.userInfo.reqUserName)}).catch(function(t){401===t.status&&(e.isLogin=!1,e.userName="")})};s();var l=function(){i({method:"POST",url:r.sysParams,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},data:"token="+(n.localStorage.getItem("token")||"")}).then(function(e){e.data&&200===e.data.code&&(t.payOpen="Y"===e.data.onlinePayFlag,t.helpAccountOpen="Y"===e.data.accountantShowFlag)})};l();var c=a.find("#hideForm");e.uuidVal=n.localStorage.getItem("uuid"),e.trigAct=function(t){e.action=r[t],n.setTimeout(function(){c.trigger("submit")})},e.logout=function(){i({method:"POST",url:r.logout,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},data:"token="+n.localStorage.getItem("token")}).then(function(e){"success"===e.data.status&&(s(),l())})}}]).controller("overviewCtrl",["$window","$scope",function(e,t){t.setAnchor=function(t){e.sessionStorage.setItem("anchor",t)}}]).controller("demoCtrl",["$scope","$timeout","$element","$window","$rootScope","$state","Texts",function(e,t,i,a,n,r,o){var s=o.demoTexts;e.mode="single",e.$on("$viewContentLoaded",function(){e.demoText=s[r.current.name],e.allowTemplateSel="demo.busLis"===r.current.name,e.allowFieldConf="demo.vat"===r.current.name||"demo.busLis"===r.current.name,e.isFace="demo.face"===r.current.name,e.isIdCard="demo.idCard"===r.current.name,e.isCreditCard="demo.creditCard"===r.current.name,e.isVat="demo.vat"===r.current.name,e.isFinSta="demo.finSta"===r.current.name,e.isBusLis="demo.busLis"===r.current.name,e.isFullText="demo.fullText"===r.current.name,e.isSilentLive="demo.silentLive"===r.current.name,e.isHelpAccount="demo.helpAccount"===r.current.name,e.allowModeSel=!(e.isFace||e.isFullText||e.isSilentLive||e.isHelpAccount)})}]).controller("demoFaceCtrl",["$scope","$rootScope","$window","$timeout","$element","FileSrv","$http","Api","NetSrv","UI","Texts",function(e,t,i,a,n,r,o,s,l,c,u){e.sampleUrl=u.sampleUrl.face,e.dataList=[[],[]],e.activeIndex=[-1,-1];var d={},f=function(t,i){e.result=t,e.failed=!("00000"===t.mpRecognition.resCd),i&&(d[i]=t)},p=!0,v=function(){if(e.dataList[0].length&&e.dataList[1].length){var t={imgName1:e.dataList[0][e.activeIndex[0]].originFile.name,imgSize1:e.dataList[0][e.activeIndex[0]].originFile.size,imgTime1:e.dataList[0][e.activeIndex[0]].originFile.lastModified,imgName2:e.dataList[1][e.activeIndex[1]].originFile.name,imgSize2:e.dataList[1][e.activeIndex[1]].originFile.size,imgTime2:e.dataList[1][e.activeIndex[1]].originFile.lastModified},a=md5(JSON.stringify(t));if(d[a])f(d[a]);else{var n=function(t){f(t,a),p=!0,e.isLoading=!1};if(!p)return;e.isLoading=!0;var r=new FormData;r.append("visitorFlag",i.sessionStorage.getItem("visitorFlag")),r.append("imgFile",e.dataList[0][e.activeIndex[0]].file),r.append("imgFile",e.dataList[1][e.activeIndex[1]].file),l.ajaxFw({url:s.face,data:r,headers:{"Content-Type":void 0},processor:n,fail:n,failAlert:!0}),p=!1}}};Object.defineProperty(e,"simiDesc",{get:function(){if(e.result&&e.result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.ucScore){var t=~~(100*e.result.mpRecognition.ocrInfoList.ocrInfo.ocrResult.ucScore);if(t>=90)return"可能性很高";if(t<90&&t>=80)return"可能性高";if(t<80&&t>=30)return"可能性低";if(t<30)return"可能性很低"}}}),e.fileChanged=function(t,i){if(t.files.length&&/^image\/\w+$/g.test(t.files[0].type)){var a={originFile:t.files[0],src:window.URL.createObjectURL(t.files[0])};r.imgCompress({file:t.files[0],maxPix:4915200,maxByte:1048576,cpsRatio:.7}).then(function(n){a.file=n,e.dataList[i].length<5?(e.dataList[i].push(a),e.activeIndex[i]=e.dataList[i].length-1):e.dataList[i][e.activeIndex[i]]=a,t.value="",e.$apply("dataList"),v()})}},e.$watch("activeIndex",function(e,t){e!==t&&v()},!0)}]).controller("demoIdCardCtrl",["$scope","$window","Api","FileSrv","NetSrv","$http","UI","Texts",function(e,t,i,a,n,r,o,s){e.sampleUrl=s.sampleUrl.idCard,e.resolver=s.resolver.idCard,e.trans=s.trans.idCard,e.dataList=[],e.activeIndex=-1;var l={},c=function(t,i){e.result=t,e.failed=!("00000"===t.mpRecognition.resCd),i&&(l[i]=t)},u=!0,d=function(){if(e.dataList.length){var a={imgName:e.dataList[e.activeIndex].file.name,imgSize:e.dataList[e.activeIndex].file.size,imgTime:e.dataList[e.activeIndex].file.lastModified,region:e.region.value},r=md5(JSON.stringify(a));if(l[r])c(l[r]);else{var o=function(e){c(e,r),u=!0};if(!u)return;var s=new FormData;s.append("visitorFlag",t.sessionStorage.getItem("visitorFlag")),s.append("imgFile",e.dataList[e.activeIndex].file),s.append("region",e.region.value),n.ajaxFw({url:i.idCard,data:s,headers:{"Content-Type":void 0},processor:o,fail:o,failAlert:!0}),u=!1}}};e.fileChanged=function(t){if(t.files.length&&/^image\/\w+$/g.test(t.files[0].type)){var i={file:t.files[0],src:window.URL.createObjectURL(t.files[0])};e.dataList.length<5?(e.dataList.push(i),e.activeIndex=e.dataList.length-1):e.dataList[e.activeIndex]=i,t.value="",d(),e.$apply("dataList")}},e.$watch("activeIndex",function(e,t){e!==t&&d()}),e.region={list:[{name:"内地居民二代证",value:"CN"},{name:"香港居民身份证",value:"HK"}],value:"CN"}}]).controller("demoCreditCardCtrl",["$scope","$window","Api","FileSrv","NetSrv","$http","UI","Texts","$timeout",function(e,t,i,a,n,r,o,s,l){e.sampleUrl=s.sampleUrl.creditCard,e.resolver=s.resolver.creditCard,e.trans=s.trans.creditCard,e.dataList=[],e.activeIndex=-1,e.changeActive=function(t){e.activeIndex=t};var c={},u=function(t,i){e.result=t,e.failed=!("00000"===t.mpRecognition.resCd),i&&(c[i]=t)},d=!0,f=function(){if(e.dataList.length){var a={imgName:e.dataList[e.activeIndex].file.name,imgSize:e.dataList[e.activeIndex].file.size,imgTime:e.dataList[e.activeIndex].file.lastModified},r=md5(JSON.stringify(a));if(c[r])u(c[r]);else{var o=function(e){u(e,r),d=!0};if(!d)return;var s=new FormData;s.append("visitorFlag",t.sessionStorage.getItem("visitorFlag")),s.append("imgFile",e.dataList[e.activeIndex].file),n.ajaxFw({url:i.creditCard,data:s,headers:{"Content-Type":void 0},processor:o,fail:o,failAlert:!0}),d=!1}}};e.fileChanged=function(t){if(t.files.length&&/^image\/\w+$/g.test(t.files[0].type)){var i={file:t.files[0],src:window.URL.createObjectURL(t.files[0])};e.dataList.length<5?(e.dataList.push(i),e.activeIndex=e.dataList.length-1):e.dataList[e.activeIndex]=i,t.value="",f(),e.$apply("dataList")}},e.$watch("activeIndex",function(e,t){e!==t&&f()})}]).controller("demoVatCtrl",["$scope","$window","Api","Texts","FileSrv","NetSrv","DataSrv","$http","UI",function(e,t,i,a,n,r,o,s,l){e.sampleUrl=a.sampleUrl.vat,e.resolver=a.resolver.vat,e.trans=a.trans.vat,e.dataList=[],e.activeIndex=-1;var c={},u=function(t,i){console.log(c),e.result=t,e.failed=!("00000"===t.mpRecognition.resCd),i&&(c[i]=t)},d=!0,f=function(){if(e.dataList.length){var a={imgName:e.dataList[e.activeIndex].file.name,imgSize:e.dataList[e.activeIndex].file.size,imgTime:e.dataList[e.activeIndex].file.lastModified,openField:p()},o=md5(JSON.stringify(a));if(c[o])u(c[o]);else{var s=function(e){u(e,o),d=!0};if(!d)return;r.ajaxFw({url:i.vat,data:n.formData({imgFile:e.dataList[e.activeIndex].file,visitorFlag:t.sessionStorage.getItem("visitorFlag"),openField:p()}),headers:{"Content-Type":void 0},processor:s,fail:s,failAlert:!0}),d=!1}}};e.fileChanged=function(t){if(t.files.length&&t.files.length&&/(image)|(pdf)/g.test(t.files[0].type)){var i={file:t.files[0],src:window.URL.createObjectURL(t.files[0])};n.file2base64(t.files[0]).then(function(a){i.base64=a,e.dataList.length<5?(e.dataList.push(i),e.activeIndex=e.dataList.length-1):e.dataList[e.activeIndex]=i,t.value="",f(),e.$apply("dataList")})}},e.$watch("activeIndex",function(e,t){e!==t&&f()}),e.keyEnable=function(e){return-1===["detail","RecMethod","Result"].indexOf(e)},e.fields=a.getConfig(),e.saveConfig=function(){a.saveConfig(e.fields)};var p=function(){return a.openField(e.fields)};e.$watch("fields",function(t,i){if(t!==i){var a=!0;for(var n in t)t[n].display&&t[n].checked&&(a=!1);e.saveDisabled=a}},!0)}]).controller("demoFinStaCtrl",["$scope","$window","Api","FileSrv","NetSrv","DataSrv","$http","UI","Texts",function(e,t,i,a,n,r,o,s,l){e.sampleUrl=l.sampleUrl.finSta,e.resolver=l.resolver.finSta,e.trans=l.trans.finSta,e.dataList=[],e.activeIndex=-1;var c={},u=function(t,i){e.result=t,e.failed=!("00000"===t.mpRecognition.resCd),i&&(c[i]=t)},d=!0,f=function(){if(e.dataList.length){var r={imgName:e.dataList[e.activeIndex].file.name,imgSize:e.dataList[e.activeIndex].file.size,imgTime:e.dataList[e.activeIndex].file.lastModified},o=md5(JSON.stringify(r));if(c[o])u(c[o]);else{var s=function(e){u(e,o),d=!0};if(!d)return;new FormData;n.ajaxFw({url:i.finSta,data:a.formData({visitorFlag:t.sessionStorage.getItem("visitorFlag"),imgFile:e.dataList[e.activeIndex].file}),headers:{"Content-Type":void 0},processor:s,fail:s,failAlert:!0}),d=!1}}};e.fileChanged=function(t){if(t.files.length&&/(image)|(pdf)/g.test(t.files[0].type)){var i={file:t.files[0],src:window.URL.createObjectURL(t.files[0])};a.file2base64(t.files[0]).then(function(a){i.base64=a,e.dataList.length<5?(e.dataList.push(i),e.activeIndex=e.dataList.length-1):e.dataList[e.activeIndex]=i,t.value="",f(),e.$apply("dataList")})}},e.$watch("activeIndex",function(e,t){e!==t&&f()})}]).controller("demoBusLisCtrl",["$scope","$window","Api","Texts","FileSrv","NetSrv","DataSrv","$http","UI",function(e,t,i,a,n,r,o,s,l){function c(){return a.openField(e.fields,e.template[e.tplIndex].value)}var u=function(t,i){Object.defineProperty(e,t,{get:function(){return i[e.tplIndex]},set:function(t){i[e.tplIndex]=t}})};e.template=[{name:"新版营业执照",value:12002},{name:"企业法人",value:12003},{name:"个体工商户",value:12004}],e.tplIndex=0,u("sampleUrl",a.sampleUrl.busLis),e.resolver=a.resolver.busLis,e.trans=a.trans.busLis,u("dataList",[[],[],[]]),u("activeIndex",[]),u("result",[]),u("failed",[]);var d={},f=function(t,i){e.result=t,e.failed=!("00000"===t.mpRecognition.resCd),i&&(d[i]=t)},p=!0,v=function(){if(e.dataList.length){var a={imgName:e.dataList[e.activeIndex].file.name,imgSize:e.dataList[e.activeIndex].file.size,imgTime:e.dataList[e.activeIndex].file.lastModified,template:e.template[e.tplIndex].value,openField:c()},o=md5(JSON.stringify(a));if(d[o])f(d[o]);else{var s=function(e){f(e,o),p=!0};if(!p)return;r.ajaxFw({url:i.busLis,data:n.formData({visitorFlag:t.sessionStorage.getItem("visitorFlag"),template:e.template[e.tplIndex].value,imgFile:e.dataList[e.activeIndex].file,openField:c()}),headers:{"Content-Type":void 0},processor:s,fail:s,failAlert:!0}),p=!1}}};e.fileChanged=function(t){if(t.files.length&&/^image\/\w+$/g.test(t.files[0].type)){var i={file:t.files[0],src:window.URL.createObjectURL(t.files[0])};e.dataList.length<5?(e.dataList.push(i),e.activeIndex=e.dataList.length-1):e.dataList[e.activeIndex]=i,t.value="",v(),e.$apply("dataList[tplIndex]")}},e.$watch("activeIndex",function(e,t){e!==t&&v()},!0),e.fields=a.getConfig(),e.saveConfig=function(){a.saveConfig(e.fields)},e.$watch("fields[template[tplIndex].value]",function(t,i){if(t!==i){var a=!0;for(var n in t)t[n].display&&t[n].checked&&(a=!1);e.saveDisabled=a}},!0)}]).controller("demoFullTextCtrl",["$scope","NetSrv","Api","FileSrv","$window","Texts",function(e,t,i,a,n,r){e.sampleUrl=r.sampleUrl.fullText,e.resolver=r.resolver.fullText,e.dataList=[],e.activeIndex=-1,e.coordinate=!1,e.iTypes=[{name:"其它",value:"0"},{name:"财务报表识别",value:"1"},{name:"简历识别",value:"2"}],e.iType=e.iTypes[0];var o={},s=function(t,i){console.log(o),e.result=t,e.failed=!("00000"===t.mpRecognition.resCd),i&&(o[i]=t)},l=!0,c=function(){if(e.dataList.length){var r={imgName:e.dataList[e.activeIndex].file.name,imgSize:e.dataList[e.activeIndex].file.size,imgTime:e.dataList[e.activeIndex].file.lastModified,coordinate:e.coordinate,iType:e.iType.value},c=md5(JSON.stringify(r));if(o[c])s(o[c]);else{var u=function(t){if(t.mpRecognition.ocrInfoList&&(t.mpRecognition.ocrInfoList.ocrInfo.coordinate=e.coordinate,e.coordinate&&"image"===e.dataList[e.activeIndex].file.type.split("/")[0])){var i=t.mpRecognition.ocrInfoList.ocrInfo.ocrResult;for(var a in i)if(-1!==["TextResult","TableResult"].indexOf(a))try{i[a]=JSON.parse(i[a]||"[]")}catch(e){console.log(e)}t.mpRecognition.ocrInfoList.ocrInfo.ocrResult=i}s(t,c),l=!0};if(!l)return;t.ajaxFw({url:i.fullText,data:a.formData({myfile:e.dataList[e.activeIndex].file,coordinate:e.coordinate?"1":"0",iType:e.iType.value,visitorFlag:n.sessionStorage.getItem("visitorFlag")}),headers:{"Content-Type":void 0},processor:u,fail:u,failAlert:!0}),l=!1}}};e.fileChanged=function(t){if(t.files.length&&/(image)|(pdf)/g.test(t.files[0].type)){var i={file:t.files[0],src:window.URL.createObjectURL(t.files[0])};e.dataList.length<5?(e.dataList.push(i),e.activeIndex=e.dataList.length-1):e.dataList[e.activeIndex]=i,t.value="",c(),e.$apply("dataList")}},e.$watch("activeIndex",function(e,t){e!==t&&c()})}]).controller("solutionHelpAccountCtrl",["$scope","Texts","$window","Api","DataSrv","UI","NetSrv",function(e,t,i,a,n,r,o){function s(t){(l=new WebSocket(a.helpAccountQueryWS)).onopen=function(e){console.log("Sequence "+t+" start."),l.send(JSON.stringify({sequence:t}))},l.onmessage=function(i){var a=JSON.parse(i.data);e.allData[t].results[a.mpRecognition.serialNumber]=a,e.allData[t].recElapsed=Date.now()-e.allData[t].time,e.$apply("overviewRow"),e.$apply("data"),e.currentState.finished&&l.close()},l.onclose=function(e){console.log("Sequence "+t+" over.")}}window.setTimeout(function(){$("#helpAccount .config-field li").click(function(e){e.stopPropagation()})}),e.resolver=t.resolver.helpAccount,e.fields=t.getConfig(),e.$watch("fields",function(t,a){t!==a&&i.localStorage.setItem("helpAccountVatFields",JSON.stringify(e.fields))},!0),Object.defineProperty(e,"openFieldStr",{get:function(){return t.openField(e.fields)}});var l=null;e.allData={},Object.defineProperty(e,"successData",{get:function(){var t={};for(var i in e.allData){var a={files:{},srcs:{},results:{}},n=JSON.stringify(a);for(var r in e.allData[i].results)e.allData[i].results[r].mpRecognition.toHandle||(a.results[r]=e.allData[i].results[r],a.srcs[r]=e.allData[i].srcs[r],a.files[r]=e.allData[i].files[r]);JSON.stringify(a)!==n&&(a.time=e.allData[i].time,a.uploadElapsed=e.allData[i].uploadElapsed,a.recElapsed=e.allData[i].recElapsed,t[i]=a)}return t}}),Object.defineProperty(e,"failedData",{get:function(){var t={};for(var i in e.allData){var a={files:{},srcs:{},results:{}},n=JSON.stringify(a);for(var r in e.allData[i].results)e.allData[i].results[r].mpRecognition.toHandle&&(a.results[r]=e.allData[i].results[r],a.srcs[r]=e.allData[i].srcs[r],a.files[r]=e.allData[i].files[r]);JSON.stringify(a)!==n&&(a.time=e.allData[i].time,a.uploadElapsed=e.allData[i].uploadElapsed,a.recElapsed=e.allData[i].recElapsed,t[i]=a)}return t}}),e.strEqual=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},e.data=e.allData;e.currentView="upload-rec",e.currentGroup={},e.currentSequence="";var c="";e.groupComputed={get currentGroupArray(){var t={};for(var i in e.currentGroup)t[i]="results"===i||"files"===i||"srcs"===i?[]:e.currentGroup[i];for(var i in e.currentGroup.files)t.files.push(e.currentGroup.files[i]),t.results.push(e.currentGroup.results[i]),t.srcs.push(e.currentGroup.srcs[i]);return t},get activeIndex(){var t=0;if(c&&e.currentGroup.files[c])for(var i in e.currentGroup.files){if(c===i)break;t++}return t},get groupLength(){var t=0;for(var i in e.currentGroup.files)t++;return t},get atFirst(){return 0===this.activeIndex},get atLast(){return this.activeIndex===this.groupLength-1},get indexMapProp(){var t=[];for(var i in e.currentGroup.files)t.push(i);return t},get propMapIndex(){for(var e={},t=0;t<this.indexMapProp.length;t++)e[this.indexMapProp[t]]=t;return e},toPrev:function(){this.atFirst||(this.currentSerialNumber=this.indexMapProp[this.activeIndex-1])},toNext:function(){this.atLast||(this.currentSerialNumber=this.indexMapProp[this.activeIndex+1])},get visibleImgs(){var t={};return this.groupLength<3?e.currentGroup.srcs:(this.atFirst?(t[this.indexMapProp[0]]=e.currentGroup.srcs[this.indexMapProp[0]],t[this.indexMapProp[1]]=e.currentGroup.srcs[this.indexMapProp[1]],t[this.indexMapProp[2]]=e.currentGroup.srcs[this.indexMapProp[2]]):this.atLast?(t[this.indexMapProp[this.groupLength-3]]=e.currentGroup.srcs[this.indexMapProp[this.groupLength-3]],t[this.indexMapProp[this.groupLength-2]]=e.currentGroup.srcs[this.indexMapProp[this.groupLength-2]],t[this.indexMapProp[this.groupLength-1]]=e.currentGroup.srcs[this.indexMapProp[this.groupLength-1]]):(t[this.indexMapProp[this.activeIndex-1]]=e.currentGroup.srcs[this.indexMapProp[this.activeIndex-1]],t[this.indexMapProp[this.activeIndex]]=e.currentGroup.srcs[this.indexMapProp[this.activeIndex]],t[this.indexMapProp[this.activeIndex+1]]=e.currentGroup.srcs[this.indexMapProp[this.activeIndex+1]]),t)},get currentSerialNumber(){if(!c||!e.currentGroup.files[c])for(var t in e.currentGroup.files){c=t;break}return c},set currentSerialNumber(e){c=e}},Object.defineProperty(e,"flatOcrResult",{get:function(){try{return n.dataFlat(e.currentGroup.results[e.groupComputed.currentSerialNumber].mpRecognition.ocrInfoList.ocrInfo.ocrResult,!0)}catch(e){return{}}},set:function(e){console.log(e)}}),e.ocrResultFlating=function(e){try{return n.dataFlat(e.mpRecognition.ocrInfoList.ocrInfo.ocrResult,!0)}catch(e){return{}}},Object.defineProperty(e,"flatOcrConfidence",{get:function(){try{return n.dataFlat(e.currentGroup.results[e.groupComputed.currentSerialNumber].mpRecognition.ocrInfoList.ocrInfo.ocrConfidence)}catch(e){return{}}}}),e.ocrConfidenceFlating=function(e){try{return n.dataFlat(e.mpRecognition.ocrInfoList.ocrInfo.ocrResult)}catch(e){return{}}},e.NOFilter="",e.filt=function(){e.changeCurrentGroup.merge();var t={files:{},srcs:{},results:{}};for(var i in e.currentGroup.results)e.ocrResultFlating(e.currentGroup.results[i]).InvoiceNumber&&-1!==e.ocrResultFlating(e.currentGroup.results[i]).InvoiceNumber.indexOf(e.NOFilter)&&(t.files[i]=e.currentGroup.files[i],t.srcs[i]=e.currentGroup.srcs[i],t.results[i]=e.currentGroup.results[i]);e.currentGroup=t},e.changeCurrentGroup={bySequence:function(t){e.currentGroup=e.data[t]},merge:function(){var t={files:{},srcs:{},results:{}};for(var i in e.data)for(var a in e.data[i].results)t.files[a]=e.data[i].files[a],t.srcs[a]=e.data[i].srcs[a],t.results[a]=e.data[i].results[a];e.currentGroup=t}},Object.defineProperty(e,"hasFile",{get:function(){var t=!1;for(var i in e.data)for(var a in e.data[i].files)t=!0;return t}}),e.fileChanged=function(t){function l(t,n){var r=new FormData;return r.append("visitorFlag",i.sessionStorage.getItem("visitorFlag")),r.append("openField",e.openFieldStr),r.append("serialNumber",t),r.append("sequence",e.currentSequence),r.append("myfile",v[t]),new Promise(function(t,i){o.ajaxFw({url:a.helpAccountCall,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:r,spinner:!1,processor:function(i){e.currentState.receiveCount++,e.allData[e.currentSequence].uploadElapsed=Date.now()-e.data[e.currentSequence].time,t()}})})}for(var c=t.files,u=c.length,d=0,f=!1,p=!1,v={};u--;){if(d>=20){f=!0;break}/^image\/./.test(c[u].type)?(v[n.uuid()]=c[u],d++):p=!0}var g=0;if(f&&(g=3e3,r.toast("单次最多识别 20 张图片",3e3)),p&&r.toast("包含非图片，非图片将被过滤",3e3,g),d){e.currentSequence=n.uuid();var m=Date.now();e.data[e.currentSequence]={files:v,results:{},srcs:function(){var e={};for(var t in v)e[t]=window.URL.createObjectURL(v[t]);return e}(),time:m,uploadElapsed:0,recElapsed:0},s(e.currentSequence);var h=0;for(var L in v){l(L).then(function(){for(var e in v)h&&l(e),h++}).catch(function(e){console.log(e)});break}t.value=""}},e.overviewRow={fileCount:function(e){var t=0;if(e&&e.files)for(var i in e.files)t++;return t},finishCount:function(e){var t=0;if(e&&e.results)for(var i in e.results)e.results[i].mpRecognition&&t++;return t},successCount:function(e){return this.finishCount(e)-this.failedCount(e)},failedCount:function(e){var t=0;for(var i in e.results)e.results[i].mpRecognition.toHandle&&t++;return t},successRate:function(e){var t=this.successCount(e);return t/(t+this.failedCount(e))||0},createDate:function(e){return e.time},totalSize:function(e){var t=0;for(var i in e.files)t+=e.files[i].size;return t},uploadElapsed:function(e){return e.uploadElapsed},recElapsed:function(e){return e.recElapsed}},e.currentState={get sequence(){return e.currentSequence},get data(){return e.allData[this.sequence]},get fileCount(){return e.overviewRow.fileCount(this.data)},get totalSize(){return e.overviewRow.totalSize(this.data)},get successCount(){return e.overviewRow.successCount(this.data)},get failedCount(){return e.overviewRow.failedCount(this.data)},get successRate(){return e.overviewRow.successRate(this.data)},_receiveCountMap:{},get receiveCount(){return void 0===this._receiveCountMap[this.sequence]&&(this._receiveCountMap[this.sequence]=0),this._receiveCountMap[this.sequence]},set receiveCount(e){this._receiveCountMap[this.sequence]=e},get finishCount(){return e.overviewRow.finishCount(this.data)},get uploadElapsed(){return e.overviewRow.uploadElapsed(this.data)},get uploadElapsedFormat(){return moment(new Date(moment().format("YYYY-MM-DD")).getTime()+this.uploadElapsed).format("mm′ss″")},get recElapsed(){return e.overviewRow.recElapsed(this.data)},get recElapsedFormat(){return moment(new Date(moment().format("YYYY-MM-DD")).getTime()+this.recElapsed).format("mm′ss″")},get finished(){return this.finishCount===this.fileCount}}}]).controller("demoSilentLiveCtrl",["$scope","$window","NetSrv","Api",function(e,t,i,a){e.data={files:[],src:[],result:null,status:0};var n=function(i){e.data.files.length<3&&(e.data.files.push(i),e.data.src.push(t.URL.createObjectURL(i))),e.$apply("data")};e.capture=function(e){n(e)},e.fileChanged=function(e){e.files.length&&/image\/\w+/g.test(e.files[0].type)&&n(e.files[0])},e.resultMap={1:"攻击样本",2:"活体"};var r=function(t){e.data.result=t,e.failed=!1,e.data.status=1},o=function(t){e.data.result=t,e.failed=!0,e.data.status=1};e.reco=function(){var n=new FormData;n.append("visitorFlag",t.sessionStorage.getItem("visitorFlag")),n.append("imgFiles",e.data.files[0]),n.append("imgFiles",e.data.files[1]),n.append("imgFiles",e.data.files[2]),i.ajaxFw({url:a.silentLive,headers:{"Content-Type":void 0,"X-Requested-With":"XMLHttpRequest"},data:n,processor:r,fail:o})},e.reset=function(){e.data.files.length=0,e.data.src.length=0,e.data.result=null,e.data.status=0,e.failed=!1}}]).controller("demoBatchCtrl",["$scope","$rootScope","$window","Api","UI","$http","FileSrv","DataSrv","$state","Texts",function(t,i,a,n,r,o,s,l,c,u){function d(i){var a={serviceType:v[p],template:void 0!==t.tplIndex?t.template[t.tplIndex].value:"",responseType:0,sequence:l.uuid(),visitorFlag:window.sessionStorage.getItem("visitorFlag"),openField:h(),region:t.region?t.region.value:""},s=new FormData;for(var c in a)s.append(c,a[c]);for(var u=0;u<i.length;u++)s.append("imgFile",i[u]);return t.isLoading=!0,o({method:"POST",url:n.batch,transformRequest:e.identity,data:s,headers:{"Content-Type":void 0}}).then(function(e){t.isAdd?Array.prototype.push.apply(t.dataList[t.activeIndex].result.mpRecognition.ocrInfoList,e.data.mpRecognition.ocrInfoList):t.dataList[t.activeIndex].result=e.data;t.dataList[t.activeIndex].result.mpRecognition.ocrInfoList},function(e){r.toast("请求失败，请检查网络连接。")}).then(function(){t.isLoading=!1})}var f=c.current.name,p=f.substr(f.indexOf(".")+1),v={face:"7",idCard:"3",creditCard:"2",vat:"5",finSta:"6",busLis:"4"};t.resolver=u.rsvBatch[p],t.trans=u.trans[p],t.dataList=[],t.activeIndex=0,t.isLoading=!1,t.isSingleView=!1,t.isAdd=!1;var g="fields";if(t.$parent.isBusLis){console.log(t);var m=function(e,i){Object.defineProperty(t,e,{get:function(){return i[t.tplIndex]},set:function(e){i[t.tplIndex]=e}})};t.template=[{name:"新版营业执照",value:12002},{name:"企业法人",value:12003},{name:"个体工商户",value:12004}],t.tplIndex=0,t.changeTpl=function(e){t.tplIndex=e,t.isSingleView=!1},m("dataList",[[],[],[]]),m("activeIndex",[]),g="fields[template[tplIndex].value]"}t.region={list:[{name:"内地居民二代证",value:"CN"},{name:"香港居民二代证",value:"HK"}],value:"CN"},t.fields=u.getConfig(),t.saveConfig=function(){u.saveConfig(t.fields)};var h=function(){return u.openField(t.fields,0===t.tplIndex||t.tplIndex?t.template[t.tplIndex].value:null)};t.$watch(g,function(e,i){if(e!==i){var a=!0;for(var n in e)e[n].display&&e[n].checked&&(a=!1);t.saveDisabled=a}},!0),t.acceptFileTypes=["image/gif","image/jpeg","image/png"],t.$parent.$parent.isVat&&t.acceptFileTypes.push("application/pdf"),t.fileChanged=function(e){if(e.files.length){for(var i=0;i<e.files.length;i++)if(-1===t.acceptFileTypes.indexOf(e.files[i].type))return;var a=[];Array.prototype.push.apply(a,e.files),e.files.length>4&&(a=a.slice(0,4),r.toast("单次最多识别 4 张图片",5e3));var n=new function(e){this.files=e;for(var t=[],i=0;i<e.length;i++)t.push(window.URL.createObjectURL(e[i]));this.thumbs=t,this.activeIndex=e.length-1,Object.defineProperty(this,"commonTh",{get:function(){var e=[];if(!this.result||!this.result.mpRecognition.ocrInfoList||!this.result.mpRecognition.ocrInfoList.length)return e;for(var t=this.result.mpRecognition.ocrInfoList,i=t.length;i--;){var a=function(t){for(var i in t)-1===e.indexOf(i)&&e.push(i)},n=t[i].ocrInfo.ocrResult;if(n&&n.length)for(var r=n.length;r--;)a(n[r]||{});else a(n)}return e}})}(a);t.dataList.length>4?t.dataList[t.activeIndex]=n:(t.dataList.push(n),t.activeIndex=t.dataList.length-1),d(a),t.$apply("dataList"),e.value=""}},t.vatKeyEnable=function(e){return-1===["detail","RecMethod","Result"].indexOf(e)},t.addImg=function(e){if(e.files.length){for(s=0;s<e.files.length;s++)if(-1===t.acceptFileTypes.indexOf(e.files[s].type))return;t.isAdd=!0;var i=4-t.dataList[t.activeIndex].files.length,n=[];Array.prototype.push.apply(n,e.files),e.files.length>i&&(n=n.slice(0,i),r.toast("此次最多可添加 "+i+" 张图片",5e3)),Array.prototype.push.apply(t.dataList[t.activeIndex].files,n);for(var o=[],s=0;s<n.length;s++)o.push(a.URL.createObjectURL(n[s]));Array.prototype.push.apply(t.dataList[t.activeIndex].thumbs,o),t.dataList[t.activeIndex].activeIndex=t.dataList[t.activeIndex].files.length-1,d(n).then(function(){t.isAdd=!1}),e.value="",t.$apply("dataList")}},t.toSingleView=function(){t.isSingleView=!0},t.toPandect=function(){t.isSingleView=!1},t.delete=function(e){if(t.dataList[t.activeIndex].files.splice(e,1),t.dataList[t.activeIndex].thumbs.splice(e,1),t.dataList[t.activeIndex].result.mpRecognition.ocrInfoList.splice(e,1),t.isSingleView=!1,!t.dataList[t.activeIndex].files.length)return t.dataList.splice(t.activeIndex,1),void(t.activeIndex>=t.dataList.length&&(t.activeIndex=t.dataList.length-1));t.dataList[t.activeIndex].activeIndex>=t.dataList[t.activeIndex].files.length&&(t.dataList[t.activeIndex].activeIndex=t.dataList[t.activeIndex].files.length-1)}}]).controller("docCtrl",["$window","$location","$rootScope","$anchorScroll",function(e,t,i,a){var n=e.sessionStorage.getItem("anchor");n&&a(n),e.sessionStorage.removeItem("anchor")}]).controller("priceCtrl",["$scope","$http","Api",function(e,t,i){e.current={storageApiTab:0,priceTab:0},e.storageTrans={23:"存储空间（GB）",3:"存储空间（月）"},t.get(i.price.feesPerTime).then(function(t){200===t.status&&t.data&&(e.perTime=t.data)}),t.get(i.price.feesPerMonth).then(function(t){200===t.status&&t.data&&(e.perMonth=t.data)}),t.get(i.price.feesPerYear).then(function(t){200===t.status&&t.data&&(e.perYear=t.data)}),t.get(i.price.imageStorage).then(function(t){200===t.status&&t.data&&(e.imageStorage=t.data)})}]).controller("contactCtrl",["$scope","$rootScope",function(e,t){e.current=0}])}(window.angular);